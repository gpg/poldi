2005-12-03  Moritz Schulte  <moritz@g10code.com>

	* pam_poldi.c (ask_user): New parameter: secret.
	(pam_conversation): Pass SECRET argument.
	(pam_sm_authenticate): Rewritten in parts, simplified.
	Adjusted to new usersdb API.

2005-11-12  Moritz Schulte  <moritz@g10code.com>

	* pam_poldi.c (pam_sm_authenticate): Adjust to new wait_for_card()
	API.

	* Makefile.am (libpoldi_common_a_CFLAGS): Added include path:
	$(top_srcdir)/src/common.

2005-10-31  Moritz Schulte  <moritz@g10code.com>

	* pam_poldi.c: Added some more comments.
	(pam_sm_authenticate): Adjusted to new wait_for_card() API.
	(conv_opaque_t): New type.
	(pam_conversation): New function.
	(wait_for_card): Removed function, it's not included in common/.
	(do_auth): Removed function; use authenticate() now, which is
	included in common/.
	
	(lookup_key): Removed function; use key_lookup_by_username() now,
	which is included in common/.

2005-10-29  Moritz Schulte  <moritz@g10code.com>

	* pam_poldi.c: More verbose logging.
	(tell_user): Declare FMT const.

2005-10-23  Moritz Schulte  <moritz@g10code.com>

	* pam_poldi.c: Remove Syslog logging macros, use jnlib logging
	only (which does support logging to Syslog now).
	(pam_sm_authenticate): Call log_set_syslog or log_set_file,
	depending on the value of pam_poldi_opt.logfile.
	(username_void, conv_void): New local variables, use them when
	retrieving items from the PAM environment in order to follow
	strict-aliasing rules.

2005-10-16  Moritz Schulte  <moritz@g10code.com>

	* pam_poldi.c (lookup_key): Use key_filename_construct() instead
	of make_filename() directly.
	Re-ordered functions, clean-up, added comments.

2005-10-15  Moritz Schulte  <moritz@g10code.com>

	* pam_poldi.c (parse_argv): Fixed typo related to timeout argument
	parsing.

2005-10-08  Moritz Schulte  <moritz@g10code.com>

	* pam_poldi.c: Remove `fake-wait-for-card'-feature.

	* Makefile.am: Drop ugly install-pam-module mechanism, implement
	install-exec-local and uninstall-local target.

	* pam_poldi.c (pam_sm_authenticate): Disable buffering on stderr.
	We need to disable bufferring on stderr, since it might have been
	enabled by log_set_file().  Buffering on stderr will complicate
	PAM interaction, since e.g. libpam-misc's misc_conv() function
	does expect stderr to be unbuffered.

2005-09-27  Moritz Schulte  <moritz@g10code.com>

	* pam_poldi.c (struct pam_poldi_opt): New member: TIMEOUT.
	(pam_poldi_opt): Extend struct initialization.
	(enum arg_opt_ids): New entry: ARG_WAIT_TIMEOUT.
	(pam_poldi_options_cb): Handle ARG_WAIT_TIMEOUT.
	(wait_for_card): New variables; TIMEOUT, WAIT; initialize them
	depending on FAKE and PAM_POLDI_OPT.TIMEOUT; pass TIMEOUT and WAIT
	to card_init.
	(lookup_key): Use usersdb_lookup_by_username() instead of
	username_to_serialno(); remove const attribute from SERIALNO.
	(wait_for_card): Remove const attribute from SERIALNO.
	(pam_sm_authenticate): Likewise.
	(pam_sm_authenticate): Use usersdb_lookup_by_serialno() instead of
	serialno_to_username(); remove const attribute from account.


2005-07-13  Moritz Schulte  <moritz@g10code.com>

	* pam_poldi.c (wait_for_card): Adjust to new card_info() API.

2004-11-27  Moritz Schulte  <moritz@g10code.com>

	* pam_poldi.c (wait_for_card): Adjust card_init caller.  Implement
	require_card_switch option.
